name: 'Application Health Check'
description: 'Argocd Application Health Check'
inputs:
  application:  # id of input
    description: 'Name of the Application'
    required: true
    default: 'cluster-autoscaler'
  servername:
    description: 'Argocd server endpoint'
    required: true
  version:
    description: 'Expected version'
    required: true
    default: '1.0'
  username:
    description: 'Argocd User Name'
    required: true
    default: 'admin'
  password:
    description: 'Argocd Password'
    required: true
outputs:
  HealthStatus: 
    description: "Application Health Status"
    value: ${{ steps.app-health.outputs.status }}
runs:
  using: "composite"
  steps: 
    - id: install-argocd-cli
      run: curl -sSL -o ./argocd https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64; chmod +x ./argocd
      shell: bash
    - id: login
      run: ./argocd --grpc-web login ${{ inputs.servername }} --username=${{ inputs.username }} --password=${{ inputs.password }}
      shell: bash
    - id: app-health
      run: echo "::set-output name=status::$(${{ github.action_path }}/healthcheck.sh ${{ inputs.application }})"
      shell: bash
